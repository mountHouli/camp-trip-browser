# camp-trip-client

For booking trips.

## Miscellaneous Notes

Used node v9.8.0 while developing.

npm script "lint" explicity specifies exit status 0 because eslint produces exit status 1 when it finds lint errors and the npm script runner detects this and reports that the command had an error.

Here is why I'm using Redux and not MobX
- I prefer things that make it easier to reason about state (Redux has one state store, not multiple)
- I prefer good tools and maintainabililty (immutable state, great debug tools)
- I don't care that my app might be pretty simple.  The extra boilerplate of redux doesn't bother me.  I rather keep things maintainable.
See:
- https://codeburst.io/mobx-vs-redux-with-react-a-noobs-comparison-and-questions-382ba340be09
- https://www.robinwieruch.de/redux-mobx-confusion/

## To-Do

- Build system
  - Setup dev envr
    - debug
      - output.devtoolModuleFilenameTemplate: '[absolute-resource-path]'
      - add a entry.context: param so that webpack isn't dependent on cwd
  - Minify
  - Could use code splitting to make clientIndex.bundle.js and ssrIndex.bundle.js share most of the same code.  Not necessar, however, because code splitting is usually for performance reasons.
  - move common webpack config (such as copying and cleaning files) from server to client config.

### Low Priority

- Build system
  - eslint
    - .eslintrc.json React recommended settings (see https://github.com/yannickcr/eslint-plugin-react)
  - Enable dist/ dir cleaning without webpack building.

### Done

- In server.js, require() paths are relative to where things sit in the dist directory, so make them work for env=dev as well
- Build system
  - eslint
    - make it run on files in the root dir
    - no-console rule (make it warn, or maybe remove it altogether)
  - Setup dev envr
    - Hot reloading
    - Setup SSR for prod env
    - delete client/server/shared folder structure
    - Make webpack config support both prod and dev
  - npm uninstall webpack-dev-server
  - make dist/ dir cleaning maintainable (not requiring explicity specify every file in it)

## Environment and Build System Works Like This...

Note:  `code` below is pseudocode

### Production Server Request Handling

- When a request comes in, `app.use(ssrMiddleware)` -- which comes from src/ssrIndex.js AKA dist/ssrIndex.bundle.js) -- renders the react for the requested page (react-router chooses what to render based on the URL path passed to it's Location prop) and plugs it into html generated from a template, which it then returns to the client.
- When that html reaches the browser, it has element `<script src="/public/clientIndex.bundle.js"></script>` which makes the browser grab dist/public/clientIndex.bundle.js (which is generated by webpack.config.js; also which dist/server.js's express.static() is configured to return), which--upon getting to the browser--runs and calls ReactDOM.hydrate to hydrate the existing HTML that was originally put there by ssrIndex.bundle.js

### Dev Server Request Handling

Due to SSR with react-router, two different bundles are needed--one is the bundle used for server side rendering that has <StaticRouter/> in it, and the other is the bundle that gets sent to the browser that has <BrowserRouter/> in it.

The key to setting up a dev environment with hot reloading for both of these bundles is `webpack-hot-server-middleware`.  This package is designed to be used this way:

```
const webpackConfig = require('./webpack.config.js')
const webpack = require('webpack')
const webpackHotServerMiddleware = require('webpack-hot-server-middleware')
// webpack-hot-server-middleware sees in webpack.config.js the config
// for the server bundle (the one with `name: 'server'`)
// and expects the bundle output of this config to be an express middleware
// (e.g. (req, res) => {} function) which will handle all
// the requests, render all of the html
//   (both from the html template string and the react rendered content in its
//   react root div (and again, in the ssr middleware function, it is
//   react-router's <StaticRouter/> the picks what react html to render
//   based on the URL that was requested))
// and then res.send(theCompleteHtmlForThePage) back to the client
app.use(webpackHotServerMiddleware(webpack(webpackConfig)))
```
- Since this package is designed to act as middleware.  `app.use(webpack-hot-server-middleware)` REPLACES the way things work in production, which, again, is `app.use(require(ssrIndex.bundle.js).expressMiddlewareFunctionThatRendersAllTheHtmlAndSendsItToTheClient`

### Hot Reloading Setup

Adding webpack-dev-middleware and webpack-hot-middleware only set up the server to connect/listen/send HMR updates to the browser.  You have to use react-hot-loader (via babel) to make react get and apply the updates.

#### webpack-hot-middleware config:

```
// webpack.config.js (this is pseudocode, just to give you an idea)
module.exports = {
  entry: [
    'webpack-hot-middleware/client',
    'myAppOrWhatever.js'
  ],
  plugins: [
    new webpack.HotModuleReplacementPlugin()
  ]
}

```